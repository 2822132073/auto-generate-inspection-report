import{_ as Z,r as d,o as G,c as f,a as c,b as r,d as k,e as t,f as K,g as a,w as o,F as Q,h as W,i as X,j as Y,u as ee,k as i,t as v,l as B,m as te,E as w}from"./index-DfyFu52l.js";import{f as oe}from"./date-Bl3ggAUA.js";import{t as le}from"./format-DTuyiYXy.js";const se={class:"project-list"},ae={class:"page-header"},re={class:"header-left"},ne={key:0,class:"header-stats"},ce={key:0,class:"loading-container"},de={key:1,class:"project-grid"},ue={class:"card-header"},ie={class:"card-content"},_e={class:"project-code"},pe={class:"project-name"},me={class:"project-desc"},fe={class:"project-stats"},ve={class:"stat-item"},ge={class:"stat-item"},je={class:"dialog-footer"},ye={__name:"ProjectList",setup(ke){const D=ee(),h=d(!1),g=d([]),_=d(null),x=d({}),p=d(!1),V=d(!1),m=d(null),n=d({project_code:"",project_name:"",description:""}),E={project_code:[{required:!0,message:"请输入项目代码",trigger:"blur"},{min:2,max:50,message:"项目代码长度为 2-50 个字符",trigger:"blur"},{pattern:/^[A-Za-z0-9_-]+$/,message:"项目代码只能包含字母、数字、下划线和短横线",trigger:"blur"}],project_name:[{required:!0,message:"请输入项目名称",trigger:"blur"},{min:2,max:100,message:"项目名称长度为 2-100 个字符",trigger:"blur"}],description:[{max:500,message:"项目描述最多 500 个字符",trigger:"blur"}]},P=async()=>{h.value=!0;try{const s=await X({status:"all"});g.value=s.data.projects||[],g.value.forEach(e=>{x.value[e.project_code]=0})}catch(s){console.error("获取项目列表失败:",s)}finally{h.value=!1}},z=async()=>{try{const s=await Y();_.value=s.data}catch(s){console.error("获取统计信息失败:",s)}},M=s=>x.value[s]||0,N=s=>{D.push(`/projects/${s.project_code}`)},F=()=>{P(),z()},R=()=>{n.value={project_code:"",project_name:"",description:""},m.value&&m.value.clearValidate()},U=async()=>{var s,e;if(m.value)try{await m.value.validate(),V.value=!0,await te(n.value),w.success("项目创建成功！"),p.value=!1,R(),F()}catch(u){(e=(s=u.response)==null?void 0:s.data)!=null&&e.error?w.error(u.response.data.error):u.message?console.log("表单验证失败"):w.error("创建项目失败，请稍后重试")}finally{V.value=!1}};return G(()=>{P(),z()}),(s,e)=>{const u=a("el-statistic"),L=a("Plus"),j=a("el-icon"),y=a("el-button"),S=a("el-skeleton"),T=a("FolderOpened"),$=a("el-tag"),q=a("Monitor"),A=a("Clock"),I=a("el-card"),O=a("el-empty"),C=a("el-input"),b=a("el-form-item"),H=a("el-form"),J=a("el-dialog");return c(),f("div",se,[r("div",ae,[r("div",re,[e[6]||(e[6]=r("h1",null,"项目列表",-1)),_.value?(c(),f("div",ne,[t(u,{title:"项目总数",value:_.value.total_projects},null,8,["value"]),t(u,{title:"主机总数",value:_.value.total_hosts},null,8,["value"]),t(u,{title:"巡检记录",value:_.value.total_inspections},null,8,["value"])])):K("",!0)]),t(y,{type:"primary",onClick:e[0]||(e[0]=l=>p.value=!0),size:"large"},{default:o(()=>[t(j,null,{default:o(()=>[t(L)]),_:1}),e[7]||(e[7]=i(" 创建项目 ",-1))]),_:1})]),h.value?(c(),f("div",ce,[t(S,{rows:3,animated:""})])):g.value.length>0?(c(),f("div",de,[(c(!0),f(Q,null,W(g.value,l=>(c(),k(I,{key:l.id,class:"project-card",shadow:"hover",onClick:he=>N(l)},{header:o(()=>[r("div",ue,[t(j,{size:32,color:"#409eff"},{default:o(()=>[t(T)]),_:1}),l.status==="active"?(c(),k($,{key:0,type:"success",size:"small"},{default:o(()=>[...e[8]||(e[8]=[i("活跃",-1)])]),_:1})):(c(),k($,{key:1,type:"info",size:"small"},{default:o(()=>[...e[9]||(e[9]=[i("归档",-1)])]),_:1}))])]),default:o(()=>[r("div",ie,[r("h3",_e,v(l.project_code),1),r("p",pe,v(l.project_name),1),r("p",me,v(B(le)(l.description,100)),1),r("div",fe,[r("div",ve,[t(j,null,{default:o(()=>[t(q)]),_:1}),r("span",null,v(M(l.project_code))+" 台主机",1)]),r("div",ge,[t(j,null,{default:o(()=>[t(A)]),_:1}),r("span",null,v(B(oe)(l.created_at)),1)])])])]),_:2},1032,["onClick"]))),128))])):(c(),k(O,{key:2,description:"暂无项目数据，请通过 API 提交巡检数据","image-size":200},{default:o(()=>[t(y,{type:"primary",onClick:F},{default:o(()=>[...e[10]||(e[10]=[i("刷新",-1)])]),_:1})]),_:1})),t(J,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=l=>p.value=l),title:"创建新项目",width:"500px",onClose:R},{footer:o(()=>[r("span",je,[t(y,{onClick:e[4]||(e[4]=l=>p.value=!1)},{default:o(()=>[...e[11]||(e[11]=[i("取消",-1)])]),_:1}),t(y,{type:"primary",onClick:U,loading:V.value},{default:o(()=>[...e[12]||(e[12]=[i(" 创建 ",-1)])]),_:1},8,["loading"])])]),default:o(()=>[t(H,{ref_key:"formRef",ref:m,model:n.value,rules:E,"label-width":"100px"},{default:o(()=>[t(b,{label:"项目代码",prop:"project_code"},{default:o(()=>[t(C,{modelValue:n.value.project_code,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.project_code=l),placeholder:"请输入项目代码，如: PRJ001",clearable:""},null,8,["modelValue"])]),_:1}),t(b,{label:"项目名称",prop:"project_name"},{default:o(()=>[t(C,{modelValue:n.value.project_name,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.project_name=l),placeholder:"请输入项目名称",clearable:""},null,8,["modelValue"])]),_:1}),t(b,{label:"项目描述",prop:"description"},{default:o(()=>[t(C,{modelValue:n.value.description,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.description=l),type:"textarea",rows:4,placeholder:"请输入项目描述（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},we=Z(ye,[["__scopeId","data-v-8700927d"]]);export{we as default};
